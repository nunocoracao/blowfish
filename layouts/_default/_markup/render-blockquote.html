{{/* layouts/_default/_markup/render-blockquote.html */}}
{{/*
   GitHub‑style alert (GFM blockquote) render‑hook for Hugo ≥ 0.134
   – Supports custom titles (.AlertTitle)
   – Supports foldable callouts via .AlertSign ("+" open / "-" closed)
   – Uses Blowfish icon partial for consistency
*/}}

{{ $allowed := slice "note" "tip" "important" "warning" "caution" }}
{{ if and (eq .Type "alert") (in $allowed (.AlertType | lower)) }}
  {{- $alertType := .AlertType | lower -}}

  {{/* Title resolution: explicit > i18n("alert.<type>") > Title‑case type */}}
  {{- $alertTitle := .AlertTitle -}}
  {{- if not $alertTitle -}}
    {{- $i18nKey := printf "alert.%s" $alertType -}}
    {{- $t := i18n $i18nKey -}}
    {{- if ne $t $i18nKey -}}
      {{- $alertTitle = $t -}}
    {{- else -}}
      {{- $alertTitle = (.AlertType | title) -}}
    {{- end -}}
  {{- end -}}

  {{/* Icon mapping (only GFM 5) */}}
  {{- $icon := "" -}}
  {{- if eq $alertType "note" -}}
    {{- $icon = "circle-info" -}}
  {{- else if eq $alertType "tip" -}}
    {{- $icon = "lightbulb" -}}
  {{- else if eq $alertType "important" -}}
    {{- $icon = "bell" -}}
  {{- else if eq $alertType "warning" -}}
    {{- $icon = "triangle-exclamation" -}}
  {{- else if eq $alertType "caution" -}}
    {{- $icon = "fire" -}}
  {{- else -}}
    {{- $icon = "triangle-exclamation" -}}
  {{- end -}}

  {{/* Foldable vs static rendering */}}
  {{- if .AlertSign -}}
    {{- $isOpen := eq .AlertSign "+" -}}
    <details class="gfm-bq gfm-bq-{{ $alertType }}" {{ if $isOpen }}open{{ end }}>
      <summary class="gfm-bq-heading">
        <span class="gfm-bq-icon">{{ partial "icon.html" $icon }}</span>
        <span class="gfm-bq-title-text">{{ $alertTitle }}</span>
      </summary>
      <div class="gfm-bq-content">
        {{ .Text | safeHTML }}
      </div>
    </details>
  {{- else -}}
    <blockquote class="gfm-bq gfm-bq-{{ $alertType }}">
      <div class="gfm-bq-heading">
        <span class="gfm-bq-icon">{{ partial "icon.html" $icon }}</span>
        <span class="gfm-bq-title-text">{{ $alertTitle }}</span>
      </div>
      <div class="gfm-bq-content">
        {{ .Text | safeHTML }}
      </div>
    </blockquote>
  {{- end -}}
{{ else }}
  <blockquote>
    {{ .Text }}
  </blockquote>
{{ end }}
