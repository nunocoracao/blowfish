{"version":3,"file":"journeyDiagram-25debde4.js","sources":["../src/diagrams/user-journey/parser/journey.jison","../src/diagrams/user-journey/journeyDb.js","../src/diagrams/user-journey/styles.js","../src/diagrams/user-journey/svgDraw.js","../src/diagrams/user-journey/journeyRenderer.ts","../src/diagrams/user-journey/journeyDiagram.ts"],"sourcesContent":["/** mermaid\n *  https://mermaidjs.github.io/\n *  (c) 2015 Knut Sveidqvist\n *  MIT license.\n */\n%lex\n%options case-insensitive\n%x acc_title\n%x acc_descr\n%x acc_descr_multiline\n\n// Directive states\n%x open_directive type_directive arg_directive\n\n\n%%\n\n\\%\\%\\{                                                          { this.begin('open_directive'); return 'open_directive'; }\n<open_directive>((?:(?!\\}\\%\\%)[^:.])*)                          { this.begin('type_directive'); return 'type_directive'; }\n<type_directive>\":\"                                             { this.popState(); this.begin('arg_directive'); return ':'; }\n<type_directive,arg_directive>\\}\\%\\%                            { this.popState(); this.popState(); return 'close_directive'; }\n<arg_directive>((?:(?!\\}\\%\\%).|\\n)*)                            return 'arg_directive';\n\\%%(?!\\{)[^\\n]*                                                 /* skip comments */\n[^\\}]\\%\\%[^\\n]*                                                 /* skip comments */\n[\\n]+                   return 'NEWLINE';\n\\s+                     /* skip whitespace */\n\\#[^\\n]*                /* skip comments */\n\n\"journey\"               return 'journey';\n\"title\"\\s[^#\\n;]+       return 'title';\naccTitle\\s*\":\"\\s*                                               { this.begin(\"acc_title\");return 'acc_title'; }\n<acc_title>(?!\\n|;|#)*[^\\n]*                                    { this.popState(); return \"acc_title_value\"; }\naccDescr\\s*\":\"\\s*                                               { this.begin(\"acc_descr\");return 'acc_descr'; }\n<acc_descr>(?!\\n|;|#)*[^\\n]*                                    { this.popState(); return \"acc_descr_value\"; }\naccDescr\\s*\"{\"\\s*                                { this.begin(\"acc_descr_multiline\");}\n<acc_descr_multiline>[\\}]                       { this.popState(); }\n<acc_descr_multiline>[^\\}]*                     return \"acc_descr_multiline_value\";\n\"section\"\\s[^#:\\n;]+    return 'section';\n[^#:\\n;]+               return 'taskName';\n\":\"[^#\\n;]+             return 'taskData';\n\":\"                     return ':';\n<<EOF>>                 return 'EOF';\n.                       return 'INVALID';\n\n/lex\n\n%left '^'\n\n%start start\n\n%% /* language grammar */\n\nstart\n\t: journey document 'EOF' { return $2; }\n\t| directive start\n\t;\n\ndocument\n\t: /* empty */ { $$ = [] }\n\t| document line {$1.push($2);$$ = $1}\n\t;\n\nline\n\t: SPACE statement { $$ = $2 }\n\t| statement { $$ = $1 }\n\t| NEWLINE { $$=[];}\n\t| EOF { $$=[];}\n\t;\n\ndirective\n  : openDirective typeDirective closeDirective 'NEWLINE'\n  | openDirective typeDirective ':' argDirective closeDirective 'NEWLINE'\n  ;\n\nstatement\n  : title {yy.setDiagramTitle($1.substr(6));$$=$1.substr(6);}\n  | acc_title acc_title_value  { $$=$2.trim();yy.setAccTitle($$); }\n  | acc_descr acc_descr_value  { $$=$2.trim();yy.setAccDescription($$); }\n  | acc_descr_multiline_value { $$=$1.trim();yy.setAccDescription($$); }\n  | section {yy.addSection($1.substr(8));$$=$1.substr(8);}\n  | taskName taskData {yy.addTask($1, $2);$$='task';}\n  | directive\n  ;\n\nopenDirective\n  : open_directive { yy.parseDirective('%%{', 'open_directive'); }\n  ;\n\ntypeDirective\n  : type_directive { yy.parseDirective($1, 'type_directive'); }\n  ;\n\nargDirective\n  : arg_directive { $1 = $1.trim().replace(/'/g, '\"'); yy.parseDirective($1, 'arg_directive'); }\n  ;\n\ncloseDirective\n  : close_directive { yy.parseDirective('}%%', 'close_directive', 'journey'); }\n  ;\n\n%%\n","import mermaidAPI from '../../mermaidAPI';\nimport * as configApi from '../../config';\nimport {\n  setAccTitle,\n  getAccTitle,\n  setDiagramTitle,\n  getDiagramTitle,\n  getAccDescription,\n  setAccDescription,\n  clear as commonClear,\n} from '../../commonDb';\n\nlet currentSection = '';\n\nconst sections = [];\nconst tasks = [];\nconst rawTasks = [];\n\nexport const parseDirective = function (statement, context, type) {\n  mermaidAPI.parseDirective(this, statement, context, type);\n};\n\nexport const clear = function () {\n  sections.length = 0;\n  tasks.length = 0;\n  currentSection = '';\n  rawTasks.length = 0;\n  commonClear();\n};\n\nexport const addSection = function (txt) {\n  currentSection = txt;\n  sections.push(txt);\n};\n\nexport const getSections = function () {\n  return sections;\n};\n\nexport const getTasks = function () {\n  let allItemsProcessed = compileTasks();\n  const maxDepth = 100;\n  let iterationCount = 0;\n  while (!allItemsProcessed && iterationCount < maxDepth) {\n    allItemsProcessed = compileTasks();\n    iterationCount++;\n  }\n\n  tasks.push(...rawTasks);\n\n  return tasks;\n};\n\nconst updateActors = function () {\n  const tempActors = [];\n  tasks.forEach((task) => {\n    if (task.people) {\n      tempActors.push(...task.people);\n    }\n  });\n\n  const unique = new Set(tempActors);\n  return [...unique].sort();\n};\n\nexport const addTask = function (descr, taskData) {\n  const pieces = taskData.substr(1).split(':');\n\n  let score = 0;\n  let peeps = [];\n  if (pieces.length === 1) {\n    score = Number(pieces[0]);\n    peeps = [];\n  } else {\n    score = Number(pieces[0]);\n    peeps = pieces[1].split(',');\n  }\n  const peopleList = peeps.map((s) => s.trim());\n\n  const rawTask = {\n    section: currentSection,\n    type: currentSection,\n    people: peopleList,\n    task: descr,\n    score,\n  };\n\n  rawTasks.push(rawTask);\n};\n\nexport const addTaskOrg = function (descr) {\n  const newTask = {\n    section: currentSection,\n    type: currentSection,\n    description: descr,\n    task: descr,\n    classes: [],\n  };\n  tasks.push(newTask);\n};\n\nconst compileTasks = function () {\n  const compileTask = function (pos) {\n    return rawTasks[pos].processed;\n  };\n\n  let allProcessed = true;\n  for (const [i, rawTask] of rawTasks.entries()) {\n    compileTask(i);\n\n    allProcessed = allProcessed && rawTask.processed;\n  }\n  return allProcessed;\n};\n\nconst getActors = function () {\n  return updateActors();\n};\n\nexport default {\n  parseDirective,\n  getConfig: () => configApi.getConfig().journey,\n  clear,\n  setDiagramTitle,\n  getDiagramTitle,\n  setAccTitle,\n  getAccTitle,\n  setAccDescription,\n  getAccDescription,\n  addSection,\n  getSections,\n  getTasks,\n  addTask,\n  addTaskOrg,\n  getActors,\n};\n","const getStyles = (options) =>\n  `.label {\n    font-family: 'trebuchet ms', verdana, arial, sans-serif;\n    font-family: var(--mermaid-font-family);\n    color: ${options.textColor};\n  }\n  .mouth {\n    stroke: #666;\n  }\n\n  line {\n    stroke: ${options.textColor}\n  }\n\n  .legend {\n    fill: ${options.textColor};\n  }\n\n  .label text {\n    fill: #333;\n  }\n  .label {\n    color: ${options.textColor}\n  }\n\n  .face {\n    ${options.faceColor ? `fill: ${options.faceColor}` : 'fill: #FFF8DC'};\n    stroke: #999;\n  }\n\n  .node rect,\n  .node circle,\n  .node ellipse,\n  .node polygon,\n  .node path {\n    fill: ${options.mainBkg};\n    stroke: ${options.nodeBorder};\n    stroke-width: 1px;\n  }\n\n  .node .label {\n    text-align: center;\n  }\n  .node.clickable {\n    cursor: pointer;\n  }\n\n  .arrowheadPath {\n    fill: ${options.arrowheadColor};\n  }\n\n  .edgePath .path {\n    stroke: ${options.lineColor};\n    stroke-width: 1.5px;\n  }\n\n  .flowchart-link {\n    stroke: ${options.lineColor};\n    fill: none;\n  }\n\n  .edgeLabel {\n    background-color: ${options.edgeLabelBackground};\n    rect {\n      opacity: 0.5;\n    }\n    text-align: center;\n  }\n\n  .cluster rect {\n  }\n\n  .cluster text {\n    fill: ${options.titleColor};\n  }\n\n  div.mermaidTooltip {\n    position: absolute;\n    text-align: center;\n    max-width: 200px;\n    padding: 2px;\n    font-family: 'trebuchet ms', verdana, arial, sans-serif;\n    font-family: var(--mermaid-font-family);\n    font-size: 12px;\n    background: ${options.tertiaryColor};\n    border: 1px solid ${options.border2};\n    border-radius: 2px;\n    pointer-events: none;\n    z-index: 100;\n  }\n\n  .task-type-0, .section-type-0  {\n    ${options.fillType0 ? `fill: ${options.fillType0}` : ''};\n  }\n  .task-type-1, .section-type-1  {\n    ${options.fillType0 ? `fill: ${options.fillType1}` : ''};\n  }\n  .task-type-2, .section-type-2  {\n    ${options.fillType0 ? `fill: ${options.fillType2}` : ''};\n  }\n  .task-type-3, .section-type-3  {\n    ${options.fillType0 ? `fill: ${options.fillType3}` : ''};\n  }\n  .task-type-4, .section-type-4  {\n    ${options.fillType0 ? `fill: ${options.fillType4}` : ''};\n  }\n  .task-type-5, .section-type-5  {\n    ${options.fillType0 ? `fill: ${options.fillType5}` : ''};\n  }\n  .task-type-6, .section-type-6  {\n    ${options.fillType0 ? `fill: ${options.fillType6}` : ''};\n  }\n  .task-type-7, .section-type-7  {\n    ${options.fillType0 ? `fill: ${options.fillType7}` : ''};\n  }\n\n  .actor-0 {\n    ${options.actor0 ? `fill: ${options.actor0}` : ''};\n  }\n  .actor-1 {\n    ${options.actor1 ? `fill: ${options.actor1}` : ''};\n  }\n  .actor-2 {\n    ${options.actor2 ? `fill: ${options.actor2}` : ''};\n  }\n  .actor-3 {\n    ${options.actor3 ? `fill: ${options.actor3}` : ''};\n  }\n  .actor-4 {\n    ${options.actor4 ? `fill: ${options.actor4}` : ''};\n  }\n  .actor-5 {\n    ${options.actor5 ? `fill: ${options.actor5}` : ''};\n  }\n`;\n\nexport default getStyles;\n","import { arc as d3arc } from 'd3';\n\nexport const drawRect = function (elem, rectData) {\n  const rectElem = elem.append('rect');\n  rectElem.attr('x', rectData.x);\n  rectElem.attr('y', rectData.y);\n  rectElem.attr('fill', rectData.fill);\n  rectElem.attr('stroke', rectData.stroke);\n  rectElem.attr('width', rectData.width);\n  rectElem.attr('height', rectData.height);\n  rectElem.attr('rx', rectData.rx);\n  rectElem.attr('ry', rectData.ry);\n\n  if (rectData.class !== undefined) {\n    rectElem.attr('class', rectData.class);\n  }\n\n  return rectElem;\n};\n\nexport const drawFace = function (element, faceData) {\n  const radius = 15;\n  const circleElement = element\n    .append('circle')\n    .attr('cx', faceData.cx)\n    .attr('cy', faceData.cy)\n    .attr('class', 'face')\n    .attr('r', radius)\n    .attr('stroke-width', 2)\n    .attr('overflow', 'visible');\n\n  const face = element.append('g');\n\n  //left eye\n  face\n    .append('circle')\n    .attr('cx', faceData.cx - radius / 3)\n    .attr('cy', faceData.cy - radius / 3)\n    .attr('r', 1.5)\n    .attr('stroke-width', 2)\n    .attr('fill', '#666')\n    .attr('stroke', '#666');\n\n  //right eye\n  face\n    .append('circle')\n    .attr('cx', faceData.cx + radius / 3)\n    .attr('cy', faceData.cy - radius / 3)\n    .attr('r', 1.5)\n    .attr('stroke-width', 2)\n    .attr('fill', '#666')\n    .attr('stroke', '#666');\n\n  /** @param {any} face */\n  function smile(face) {\n    const arc = d3arc()\n      .startAngle(Math.PI / 2)\n      .endAngle(3 * (Math.PI / 2))\n      .innerRadius(radius / 2)\n      .outerRadius(radius / 2.2);\n    //mouth\n    face\n      .append('path')\n      .attr('class', 'mouth')\n      .attr('d', arc)\n      .attr('transform', 'translate(' + faceData.cx + ',' + (faceData.cy + 2) + ')');\n  }\n\n  /** @param {any} face */\n  function sad(face) {\n    const arc = d3arc()\n      .startAngle((3 * Math.PI) / 2)\n      .endAngle(5 * (Math.PI / 2))\n      .innerRadius(radius / 2)\n      .outerRadius(radius / 2.2);\n    //mouth\n    face\n      .append('path')\n      .attr('class', 'mouth')\n      .attr('d', arc)\n      .attr('transform', 'translate(' + faceData.cx + ',' + (faceData.cy + 7) + ')');\n  }\n\n  /** @param {any} face */\n  function ambivalent(face) {\n    face\n      .append('line')\n      .attr('class', 'mouth')\n      .attr('stroke', 2)\n      .attr('x1', faceData.cx - 5)\n      .attr('y1', faceData.cy + 7)\n      .attr('x2', faceData.cx + 5)\n      .attr('y2', faceData.cy + 7)\n      .attr('class', 'mouth')\n      .attr('stroke-width', '1px')\n      .attr('stroke', '#666');\n  }\n\n  if (faceData.score > 3) {\n    smile(face);\n  } else if (faceData.score < 3) {\n    sad(face);\n  } else {\n    ambivalent(face);\n  }\n\n  return circleElement;\n};\n\nexport const drawCircle = function (element, circleData) {\n  const circleElement = element.append('circle');\n  circleElement.attr('cx', circleData.cx);\n  circleElement.attr('cy', circleData.cy);\n  circleElement.attr('class', 'actor-' + circleData.pos);\n  circleElement.attr('fill', circleData.fill);\n  circleElement.attr('stroke', circleData.stroke);\n  circleElement.attr('r', circleData.r);\n\n  if (circleElement.class !== undefined) {\n    circleElement.attr('class', circleElement.class);\n  }\n\n  if (circleData.title !== undefined) {\n    circleElement.append('title').text(circleData.title);\n  }\n\n  return circleElement;\n};\n\nexport const drawText = function (elem, textData) {\n  // Remove and ignore br:s\n  const nText = textData.text.replace(/<br\\s*\\/?>/gi, ' ');\n\n  const textElem = elem.append('text');\n  textElem.attr('x', textData.x);\n  textElem.attr('y', textData.y);\n  textElem.attr('class', 'legend');\n\n  textElem.style('text-anchor', textData.anchor);\n\n  if (textData.class !== undefined) {\n    textElem.attr('class', textData.class);\n  }\n\n  const span = textElem.append('tspan');\n  span.attr('x', textData.x + textData.textMargin * 2);\n  span.text(nText);\n\n  return textElem;\n};\n\nexport const drawLabel = function (elem, txtObject) {\n  /**\n   * @param {any} x\n   * @param {any} y\n   * @param {any} width\n   * @param {any} height\n   * @param {any} cut\n   */\n  function genPoints(x, y, width, height, cut) {\n    return (\n      x +\n      ',' +\n      y +\n      ' ' +\n      (x + width) +\n      ',' +\n      y +\n      ' ' +\n      (x + width) +\n      ',' +\n      (y + height - cut) +\n      ' ' +\n      (x + width - cut * 1.2) +\n      ',' +\n      (y + height) +\n      ' ' +\n      x +\n      ',' +\n      (y + height)\n    );\n  }\n  const polygon = elem.append('polygon');\n  polygon.attr('points', genPoints(txtObject.x, txtObject.y, 50, 20, 7));\n  polygon.attr('class', 'labelBox');\n\n  txtObject.y = txtObject.y + txtObject.labelMargin;\n  txtObject.x = txtObject.x + 0.5 * txtObject.labelMargin;\n  drawText(elem, txtObject);\n};\n\nexport const drawSection = function (elem, section, conf) {\n  const g = elem.append('g');\n\n  const rect = getNoteRect();\n  rect.x = section.x;\n  rect.y = section.y;\n  rect.fill = section.fill;\n  // section width covers all nested tasks\n  rect.width =\n    conf.width * section.taskCount + // width of the tasks\n    conf.diagramMarginX * (section.taskCount - 1); // width of space between tasks\n  rect.height = conf.height;\n  rect.class = 'journey-section section-type-' + section.num;\n  rect.rx = 3;\n  rect.ry = 3;\n  drawRect(g, rect);\n\n  _drawTextCandidateFunc(conf)(\n    section.text,\n    g,\n    rect.x,\n    rect.y,\n    rect.width,\n    rect.height,\n    { class: 'journey-section section-type-' + section.num },\n    conf,\n    section.colour\n  );\n};\n\nlet taskCount = -1;\n/**\n * Draws an actor in the diagram with the attached line\n *\n * @param {any} elem The HTML element\n * @param {any} task The task to render\n * @param {any} conf The global configuration\n */\nexport const drawTask = function (elem, task, conf) {\n  const center = task.x + conf.width / 2;\n  const g = elem.append('g');\n  taskCount++;\n  const maxHeight = 300 + 5 * 30;\n  g.append('line')\n    .attr('id', 'task' + taskCount)\n    .attr('x1', center)\n    .attr('y1', task.y)\n    .attr('x2', center)\n    .attr('y2', maxHeight)\n    .attr('class', 'task-line')\n    .attr('stroke-width', '1px')\n    .attr('stroke-dasharray', '4 2')\n    .attr('stroke', '#666');\n\n  drawFace(g, {\n    cx: center,\n    cy: 300 + (5 - task.score) * 30,\n    score: task.score,\n  });\n\n  const rect = getNoteRect();\n  rect.x = task.x;\n  rect.y = task.y;\n  rect.fill = task.fill;\n  rect.width = conf.width;\n  rect.height = conf.height;\n  rect.class = 'task task-type-' + task.num;\n  rect.rx = 3;\n  rect.ry = 3;\n  drawRect(g, rect);\n\n  let xPos = task.x + 14;\n  task.people.forEach((person) => {\n    const colour = task.actors[person].color;\n\n    const circle = {\n      cx: xPos,\n      cy: task.y,\n      r: 7,\n      fill: colour,\n      stroke: '#000',\n      title: person,\n      pos: task.actors[person].position,\n    };\n\n    drawCircle(g, circle);\n    xPos += 10;\n  });\n\n  _drawTextCandidateFunc(conf)(\n    task.task,\n    g,\n    rect.x,\n    rect.y,\n    rect.width,\n    rect.height,\n    { class: 'task' },\n    conf,\n    task.colour\n  );\n};\n\n/**\n * Draws a background rectangle\n *\n * @param {any} elem The html element\n * @param {any} bounds The bounds of the drawing\n */\nexport const drawBackgroundRect = function (elem, bounds) {\n  const rectElem = drawRect(elem, {\n    x: bounds.startx,\n    y: bounds.starty,\n    width: bounds.stopx - bounds.startx,\n    height: bounds.stopy - bounds.starty,\n    fill: bounds.fill,\n    class: 'rect',\n  });\n  rectElem.lower();\n};\n\nexport const getTextObj = function () {\n  return {\n    x: 0,\n    y: 0,\n    fill: undefined,\n    'text-anchor': 'start',\n    width: 100,\n    height: 100,\n    textMargin: 0,\n    rx: 0,\n    ry: 0,\n  };\n};\n\nexport const getNoteRect = function () {\n  return {\n    x: 0,\n    y: 0,\n    width: 100,\n    anchor: 'start',\n    height: 100,\n    rx: 0,\n    ry: 0,\n  };\n};\n\nconst _drawTextCandidateFunc = (function () {\n  /**\n   * @param {any} content\n   * @param {any} g\n   * @param {any} x\n   * @param {any} y\n   * @param {any} width\n   * @param {any} height\n   * @param {any} textAttrs\n   * @param {any} colour\n   */\n  function byText(content, g, x, y, width, height, textAttrs, colour) {\n    const text = g\n      .append('text')\n      .attr('x', x + width / 2)\n      .attr('y', y + height / 2 + 5)\n      .style('font-color', colour)\n      .style('text-anchor', 'middle')\n      .text(content);\n    _setTextAttrs(text, textAttrs);\n  }\n\n  /**\n   * @param {any} content\n   * @param {any} g\n   * @param {any} x\n   * @param {any} y\n   * @param {any} width\n   * @param {any} height\n   * @param {any} textAttrs\n   * @param {any} conf\n   * @param {any} colour\n   */\n  function byTspan(content, g, x, y, width, height, textAttrs, conf, colour) {\n    const { taskFontSize, taskFontFamily } = conf;\n\n    const lines = content.split(/<br\\s*\\/?>/gi);\n    for (let i = 0; i < lines.length; i++) {\n      const dy = i * taskFontSize - (taskFontSize * (lines.length - 1)) / 2;\n      const text = g\n        .append('text')\n        .attr('x', x + width / 2)\n        .attr('y', y)\n        .attr('fill', colour)\n        .style('text-anchor', 'middle')\n        .style('font-size', taskFontSize)\n        .style('font-family', taskFontFamily);\n      text\n        .append('tspan')\n        .attr('x', x + width / 2)\n        .attr('dy', dy)\n        .text(lines[i]);\n\n      text\n        .attr('y', y + height / 2.0)\n        .attr('dominant-baseline', 'central')\n        .attr('alignment-baseline', 'central');\n\n      _setTextAttrs(text, textAttrs);\n    }\n  }\n\n  /**\n   * @param {any} content\n   * @param {any} g\n   * @param {any} x\n   * @param {any} y\n   * @param {any} width\n   * @param {any} height\n   * @param {any} textAttrs\n   * @param {any} conf\n   */\n  function byFo(content, g, x, y, width, height, textAttrs, conf) {\n    const body = g.append('switch');\n    const f = body\n      .append('foreignObject')\n      .attr('x', x)\n      .attr('y', y)\n      .attr('width', width)\n      .attr('height', height)\n      .attr('position', 'fixed');\n\n    const text = f\n      .append('xhtml:div')\n      .style('display', 'table')\n      .style('height', '100%')\n      .style('width', '100%');\n\n    text\n      .append('div')\n      .attr('class', 'label')\n      .style('display', 'table-cell')\n      .style('text-align', 'center')\n      .style('vertical-align', 'middle')\n      .text(content);\n\n    byTspan(content, body, x, y, width, height, textAttrs, conf);\n    _setTextAttrs(text, textAttrs);\n  }\n\n  /**\n   * @param {any} toText\n   * @param {any} fromTextAttrsDict\n   */\n  function _setTextAttrs(toText, fromTextAttrsDict) {\n    for (const key in fromTextAttrsDict) {\n      if (key in fromTextAttrsDict) {\n        // noinspection JSUnfilteredForInLoop\n        toText.attr(key, fromTextAttrsDict[key]);\n      }\n    }\n  }\n\n  return function (conf) {\n    return conf.textPlacement === 'fo' ? byFo : conf.textPlacement === 'old' ? byText : byTspan;\n  };\n})();\n\nconst initGraphics = function (graphics) {\n  graphics\n    .append('defs')\n    .append('marker')\n    .attr('id', 'arrowhead')\n    .attr('refX', 5)\n    .attr('refY', 2)\n    .attr('markerWidth', 6)\n    .attr('markerHeight', 4)\n    .attr('orient', 'auto')\n    .append('path')\n    .attr('d', 'M 0,0 V 4 L6,2 Z'); // this is actual shape for arrowhead\n};\n\nexport default {\n  drawRect,\n  drawCircle,\n  drawSection,\n  drawText,\n  drawLabel,\n  drawTask,\n  drawBackgroundRect,\n  getTextObj,\n  getNoteRect,\n  initGraphics,\n};\n","// @ts-nocheck TODO: fix file\nimport { select } from 'd3';\nimport svgDraw from './svgDraw';\nimport { getConfig } from '../../config';\nimport { configureSvgSize } from '../../setupGraphViewbox';\n\nexport const setConf = function (cnf) {\n  const keys = Object.keys(cnf);\n\n  keys.forEach(function (key) {\n    conf[key] = cnf[key];\n  });\n};\n\nconst actors = {};\n\n/** @param diagram - The diagram to draw to. */\nfunction drawActorLegend(diagram) {\n  const conf = getConfig().journey;\n  // Draw the actors\n  let yPos = 60;\n  Object.keys(actors).forEach((person) => {\n    const colour = actors[person].color;\n\n    const circleData = {\n      cx: 20,\n      cy: yPos,\n      r: 7,\n      fill: colour,\n      stroke: '#000',\n      pos: actors[person].position,\n    };\n    svgDraw.drawCircle(diagram, circleData);\n\n    const labelData = {\n      x: 40,\n      y: yPos + 7,\n      fill: '#666',\n      text: person,\n      textMargin: conf.boxTextMargin | 5,\n    };\n    svgDraw.drawText(diagram, labelData);\n\n    yPos += 20;\n  });\n}\n// TODO: Cleanup?\nconst conf = getConfig().journey;\nconst LEFT_MARGIN = conf.leftMargin;\nexport const draw = function (text, id, version, diagObj) {\n  const conf = getConfig().journey;\n  diagObj.db.clear();\n  diagObj.parser.parse(text + '\\n');\n\n  const securityLevel = getConfig().securityLevel;\n  // Handle root and Document for when rendering in sandbox mode\n  let sandboxElement;\n  if (securityLevel === 'sandbox') {\n    sandboxElement = select('#i' + id);\n  }\n  const root =\n    securityLevel === 'sandbox'\n      ? select(sandboxElement.nodes()[0].contentDocument.body)\n      : select('body');\n  // const doc = securityLevel === 'sandbox' ? sandboxElement.nodes()[0].contentDocument : document;\n\n  bounds.init();\n  const diagram = root.select('#' + id);\n\n  svgDraw.initGraphics(diagram);\n\n  const tasks = diagObj.db.getTasks();\n  const title = diagObj.db.getDiagramTitle();\n\n  const actorNames = diagObj.db.getActors();\n  for (const member in actors) {\n    delete actors[member];\n  }\n  let actorPos = 0;\n  actorNames.forEach((actorName) => {\n    actors[actorName] = {\n      color: conf.actorColours[actorPos % conf.actorColours.length],\n      position: actorPos,\n    };\n    actorPos++;\n  });\n\n  drawActorLegend(diagram);\n  bounds.insert(0, 0, LEFT_MARGIN, Object.keys(actors).length * 50);\n  drawTasks(diagram, tasks, 0);\n\n  const box = bounds.getBounds();\n  if (title) {\n    diagram\n      .append('text')\n      .text(title)\n      .attr('x', LEFT_MARGIN)\n      .attr('font-size', '4ex')\n      .attr('font-weight', 'bold')\n      .attr('y', 25);\n  }\n\n  const height = box.stopy - box.starty + 2 * conf.diagramMarginY;\n  const width = LEFT_MARGIN + box.stopx + 2 * conf.diagramMarginX;\n\n  configureSvgSize(diagram, height, width, conf.useMaxWidth);\n\n  // Draw activity line\n  diagram\n    .append('line')\n    .attr('x1', LEFT_MARGIN)\n    .attr('y1', conf.height * 4) // One section head + one task + margins\n    .attr('x2', width - LEFT_MARGIN - 4) // Subtract stroke width so arrow point is retained\n    .attr('y2', conf.height * 4)\n    .attr('stroke-width', 4)\n    .attr('stroke', 'black')\n    .attr('marker-end', 'url(#arrowhead)');\n\n  const extraVertForTitle = title ? 70 : 0;\n  diagram.attr('viewBox', `${box.startx} -25 ${width} ${height + extraVertForTitle}`);\n  diagram.attr('preserveAspectRatio', 'xMinYMin meet');\n  diagram.attr('height', height + extraVertForTitle + 25);\n};\n\nexport const bounds = {\n  data: {\n    startx: undefined,\n    stopx: undefined,\n    starty: undefined,\n    stopy: undefined,\n  },\n  verticalPos: 0,\n\n  sequenceItems: [],\n  init: function () {\n    this.sequenceItems = [];\n    this.data = {\n      startx: undefined,\n      stopx: undefined,\n      starty: undefined,\n      stopy: undefined,\n    };\n    this.verticalPos = 0;\n  },\n  updateVal: function (obj, key, val, fun) {\n    if (obj[key] === undefined) {\n      obj[key] = val;\n    } else {\n      obj[key] = fun(val, obj[key]);\n    }\n  },\n  updateBounds: function (startx, starty, stopx, stopy) {\n    const conf = getConfig().journey;\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const _self = this;\n    let cnt = 0;\n    /** @param type - Set to `activation` if activation */\n    function updateFn(type?: 'activation') {\n      return function updateItemBounds(item) {\n        cnt++;\n        // The loop sequenceItems is a stack so the biggest margins in the beginning of the sequenceItems\n        const n = _self.sequenceItems.length - cnt + 1;\n        _self.updateVal(item, 'starty', starty - n * conf.boxMargin, Math.min);\n        _self.updateVal(item, 'stopy', stopy + n * conf.boxMargin, Math.max);\n\n        _self.updateVal(bounds.data, 'startx', startx - n * conf.boxMargin, Math.min);\n        _self.updateVal(bounds.data, 'stopx', stopx + n * conf.boxMargin, Math.max);\n\n        if (!(type === 'activation')) {\n          _self.updateVal(item, 'startx', startx - n * conf.boxMargin, Math.min);\n          _self.updateVal(item, 'stopx', stopx + n * conf.boxMargin, Math.max);\n\n          _self.updateVal(bounds.data, 'starty', starty - n * conf.boxMargin, Math.min);\n          _self.updateVal(bounds.data, 'stopy', stopy + n * conf.boxMargin, Math.max);\n        }\n      };\n    }\n\n    this.sequenceItems.forEach(updateFn());\n  },\n  insert: function (startx, starty, stopx, stopy) {\n    const _startx = Math.min(startx, stopx);\n    const _stopx = Math.max(startx, stopx);\n    const _starty = Math.min(starty, stopy);\n    const _stopy = Math.max(starty, stopy);\n\n    this.updateVal(bounds.data, 'startx', _startx, Math.min);\n    this.updateVal(bounds.data, 'starty', _starty, Math.min);\n    this.updateVal(bounds.data, 'stopx', _stopx, Math.max);\n    this.updateVal(bounds.data, 'stopy', _stopy, Math.max);\n\n    this.updateBounds(_startx, _starty, _stopx, _stopy);\n  },\n  bumpVerticalPos: function (bump) {\n    this.verticalPos = this.verticalPos + bump;\n    this.data.stopy = this.verticalPos;\n  },\n  getVerticalPos: function () {\n    return this.verticalPos;\n  },\n  getBounds: function () {\n    return this.data;\n  },\n};\n\nconst fills = conf.sectionFills;\nconst textColours = conf.sectionColours;\n\nexport const drawTasks = function (diagram, tasks, verticalPos) {\n  const conf = getConfig().journey;\n  let lastSection = '';\n  const sectionVHeight = conf.height * 2 + conf.diagramMarginY;\n  const taskPos = verticalPos + sectionVHeight;\n\n  let sectionNumber = 0;\n  let fill = '#CCC';\n  let colour = 'black';\n  let num = 0;\n\n  // Draw the tasks\n  for (const [i, task] of tasks.entries()) {\n    if (lastSection !== task.section) {\n      fill = fills[sectionNumber % fills.length];\n      num = sectionNumber % fills.length;\n      colour = textColours[sectionNumber % textColours.length];\n\n      // count how many consecutive tasks have the same section\n      let taskInSectionCount = 0;\n      const currentSection = task.section;\n      for (let taskIndex = i; taskIndex < tasks.length; taskIndex++) {\n        if (tasks[taskIndex].section == currentSection) {\n          taskInSectionCount = taskInSectionCount + 1;\n        } else {\n          break;\n        }\n      }\n\n      const section = {\n        x: i * conf.taskMargin + i * conf.width + LEFT_MARGIN,\n        y: 50,\n        text: task.section,\n        fill,\n        num,\n        colour,\n        taskCount: taskInSectionCount,\n      };\n\n      svgDraw.drawSection(diagram, section, conf);\n      lastSection = task.section;\n      sectionNumber++;\n    }\n\n    // Collect the actors involved in the task\n    const taskActors = task.people.reduce((acc, actorName) => {\n      if (actors[actorName]) {\n        acc[actorName] = actors[actorName];\n      }\n\n      return acc;\n    }, {});\n\n    // Add some rendering data to the object\n    task.x = i * conf.taskMargin + i * conf.width + LEFT_MARGIN;\n    task.y = taskPos;\n    task.width = conf.diagramMarginX;\n    task.height = conf.diagramMarginY;\n    task.colour = colour;\n    task.fill = fill;\n    task.num = num;\n    task.actors = taskActors;\n\n    // Draw the box with the attached line\n    svgDraw.drawTask(diagram, task, conf);\n    bounds.insert(task.x, task.y, task.x + task.width + conf.taskMargin, 300 + 5 * 30); // stopY is the length of the descenders.\n  }\n};\n\nexport default {\n  setConf,\n  draw,\n};\n","import { DiagramDefinition } from '../../diagram-api/types';\n// @ts-ignore: TODO Fix ts errors\nimport parser from './parser/journey';\nimport db from './journeyDb';\nimport styles from './styles';\nimport renderer from './journeyRenderer';\n\nexport const diagram: DiagramDefinition = {\n  parser,\n  db,\n  renderer,\n  styles,\n  init: (cnf) => {\n    renderer.setConf(cnf.journey);\n    db.clear();\n  },\n};\n"],"names":["parser","o","k","v","l","$V0","$V1","$V2","$V3","$V4","$V5","$V6","$V7","$V8","$V9","$Va","yytext","yyleng","yylineno","yy","yystate","$$","_$","$0","str","hash","error","input","self","stack","tstack","vstack","lstack","table","TERROR","EOF","args","lexer","sharedState","yyloc","ranges","lex","token","symbol","state","action","r","yyval","p","len","newState","expected","errStr","ch","lines","oldLines","past","next","pre","c","match","indexed_rule","backup","tempMatch","index","rules","i","condition","n","yy_","$avoiding_name_collisions","YY_START","Parser","currentSection","sections","tasks","rawTasks","parseDirective","statement","context","type","mermaidAPI","clear","commonClear","addSection","txt","getSections","getTasks","allItemsProcessed","compileTasks","maxDepth","iterationCount","updateActors","tempActors","task","addTask","descr","taskData","pieces","score","peeps","peopleList","s","rawTask","addTaskOrg","newTask","compileTask","pos","allProcessed","getActors","db","configApi.getConfig","setDiagramTitle","getDiagramTitle","setAccTitle","getAccTitle","setAccDescription","getAccDescription","getStyles","options","styles","drawRect","elem","rectData","rectElem","drawFace","element","faceData","circleElement","face","smile","arc","d3arc","sad","ambivalent","drawCircle","circleData","drawText","textData","nText","textElem","span","drawLabel","txtObject","genPoints","x","y","width","height","cut","polygon","drawSection","section","conf","g","rect","getNoteRect","_drawTextCandidateFunc","taskCount","drawTask","center","maxHeight","xPos","person","colour","circle","drawBackgroundRect","bounds","getTextObj","byText","content","textAttrs","text","_setTextAttrs","byTspan","taskFontSize","taskFontFamily","dy","byFo","body","toText","fromTextAttrsDict","key","initGraphics","graphics","svgDraw","setConf","cnf","actors","drawActorLegend","diagram","getConfig","yPos","labelData","LEFT_MARGIN","draw","id","version","diagObj","securityLevel","sandboxElement","select","root","title","actorNames","member","actorPos","actorName","drawTasks","box","configureSvgSize","extraVertForTitle","obj","val","fun","startx","starty","stopx","stopy","_self","cnt","updateFn","item","_startx","_stopx","_starty","_stopy","bump","fills","textColours","verticalPos","lastSection","sectionVHeight","taskPos","sectionNumber","fill","num","taskInSectionCount","taskIndex","taskActors","acc","renderer"],"mappings":"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"}